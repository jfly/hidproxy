#!/usr/bin/env bash

set -e

model=$(tr -d '\0' < /proc/device-tree/model)
if [ "$model" != "Raspberry Pi Zero W Rev 1.1" ]; then
    echo "Uh oh, I'm not sure how to handle your device: $model"
    exit 1
fi

function enable_kernel_modules() {
    # TODO - only do all of this one time.

    # Copied from https://randomnerdtutorials.com/raspberry-pi-zero-usb-keyboard-hid/
    echo "dtoverlay=dwc2" | sudo tee -a /boot/config.txt
    echo "dwc2" | sudo tee -a /etc/modules
    echo "libcomposite" | sudo tee -a /etc/modules
}

enable_kernel_modules

sudo systemctl enable hidproxy
